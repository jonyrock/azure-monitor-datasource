define(["lodash","moment","app/core/utils/kbn","app/plugins/sdk"],function(e,t,r,i){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=o(r(0)),a=o(r(8));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"createISO8601Duration",value:function(e,t){return n.default.includes(["hour","minute","h","m"],t)?"PT"+e+t[0].toUpperCase():"P"+e+t[0].toUpperCase()}},{key:"createISO8601DurationFromInterval",value:function(t){var r=+t.slice(0,t.length-1),i=t[t.length-1];if(t.indexOf("ms")>-1)return e.createISO8601Duration(1,"m");if("s"===t[t.length-1]){var n=60*r%60;return n<1&&(n=1),e.createISO8601Duration(n,"m")}return e.createISO8601Duration(r,i)}},{key:"findClosestTimeGrain",value:function(e,t){for(var r=n.default.filter(t,function(e){return"auto"!==e}),i=r[0],o=a.default.interval_to_ms(e),s=0;s<r.length;s++)o>a.default.interval_to_ms(r[s])&&(i=s+1<r.length?r[s+1]:r[s]);return i}},{key:"createTimeGrainFromISO8601Duration",value:function(t){var r=1;"PT"===t.substring(0,2)&&(r=2);var i=t.substring(r,t.length-1),n=t.substring(t.length-1);return i+" "+e.timeUnitToText(+i,n)}},{key:"timeUnitToText",value:function(e,t){var r="";return"S"===t&&(r="second"),"M"===t&&(r="minute"),"H"===t&&(r="hour"),"D"===t&&(r="day"),e>1?r+"s":r}},{key:"createKbnUnitFromISO8601Duration",value:function(t){if("auto"===t)return"auto";var r=1;"PT"===t.substring(0,2)&&(r=2);var i=t.substring(r,t.length-1),n=t.substring(t.length-1);return i+e.timeUnitToKbn(+i,n)}},{key:"timeUnitToKbn",value:function(e,t){return"S"===t?"s":"M"===t?"m":"H"===t?"h":"D"===t?"d":void 0}}]),e}();t.default=s},function(e,r){e.exports=t},function(e,t,r){var i,n,a={},o=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===n&&(n=i.apply(this,arguments)),n}),s=function(e){var t={};return function(e){if("function"==typeof e)return e();if(void 0===t[e]){var r=function(e){return document.querySelector(e)}.call(this,e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),u=null,c=0,l=[],f=r(21);function p(e,t){for(var r=0;r<e.length;r++){var i=e[r],n=a[i.id];if(n){n.refs++;for(var o=0;o<n.parts.length;o++)n.parts[o](i.parts[o]);for(;o<i.parts.length;o++)n.parts.push(y(i.parts[o],t))}else{var s=[];for(o=0;o<i.parts.length;o++)s.push(y(i.parts[o],t));a[i.id]={id:i.id,refs:1,parts:s}}}}function d(e,t){for(var r=[],i={},n=0;n<e.length;n++){var a=e[n],o=t.base?a[0]+t.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};i[o]?i[o].parts.push(s):r.push(i[o]={id:o,parts:[s]})}return r}function h(e,t){var r=s(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=l[l.length-1];if("top"===e.insertAt)i?i.nextSibling?r.insertBefore(t,i.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),l.push(t);else if("bottom"===e.insertAt)r.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var n=s(e.insertInto+" "+e.insertAt.before);r.insertBefore(t,n)}}function m(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=l.indexOf(e);t>=0&&l.splice(t,1)}function g(e){var t=document.createElement("style");return void 0===e.attrs.type&&(e.attrs.type="text/css"),v(t,e.attrs),h(e,t),t}function v(e,t){Object.keys(t).forEach(function(r){e.setAttribute(r,t[r])})}function y(e,t){var r,i,n,a;if(t.transform&&e.css){if(!(a=t.transform(e.css)))return function(){};e.css=a}if(t.singleton){var o=c++;r=u||(u=g(t)),i=w.bind(null,r,o,!1),n=w.bind(null,r,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",v(t,e.attrs),h(e,t),t}(t),i=function(e,t,r){var i=r.css,n=r.sourceMap,a=void 0===t.convertToAbsoluteUrls&&n;(t.convertToAbsoluteUrls||a)&&(i=f(i));n&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var o=new Blob([i],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}.bind(null,r,t),n=function(){m(r),r.href&&URL.revokeObjectURL(r.href)}):(r=g(t),i=function(e,t){var r=t.css,i=t.media;i&&e.setAttribute("media",i);if(e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}.bind(null,r),n=function(){m(r)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else n()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var r=d(e,t);return p(r,t),function(e){for(var i=[],n=0;n<r.length;n++){var o=r[n];(s=a[o.id]).refs--,i.push(s)}e&&p(d(e,t),t);for(n=0;n<i.length;n++){var s;if(0===(s=i[n]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete a[s.id]}}}};var M,b=(M=[],function(e,t){return M[e]=t,M.filter(Boolean).join("\n")});function w(e,t,r,i){var n=r?"":i.css;if(e.styleSheet)e.styleSheet.cssText=b(t,n);else{var a=document.createTextNode(n),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(a,o[t]):e.appendChild(a)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationsQueryCtrl=t.QueryOptionsCtrl=t.ConfigCtrl=t.QueryCtrl=t.Datasource=void 0;var i,n=r(5),a=(i=n)&&i.__esModule?i:{default:i},o=r(15),s=r(22);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=function e(){u(this,e)};c.templateUrl="partials/query.options.html";var l=function e(){u(this,e)};l.templateUrl="partials/annotations.editor.html",t.Datasource=a.default,t.QueryCtrl=o.AzureMonitorQueryCtrl,t.ConfigCtrl=s.AzureMonitorConfigCtrl,t.QueryOptionsCtrl=c,t.AnnotationsQueryCtrl=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=s(r(0)),a=s(r(6)),o=s(r(12));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,r,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.backendSrv=r,this.templateSrv=i,this.$q=n,this.name=t.name,this.id=t.id,this.azureMonitorDatasource=new a.default(t,this.backendSrv,this.templateSrv,this.$q),this.appInsightsDatasource=new o.default(t,this.backendSrv,this.templateSrv,this.$q)}return e.$inject=["instanceSettings","backendSrv","templateSrv","$q"],i(e,[{key:"query",value:function(e){var t=[],r=n.default.cloneDeep(e),i=n.default.cloneDeep(e);return r.targets=n.default.filter(r.targets,["queryType","Azure Monitor"]),i.targets=n.default.filter(i.targets,["queryType","Application Insights"]),r.targets.length>0&&t.push(this.azureMonitorDatasource.query(r)),i.targets.length>0&&t.push(this.appInsightsDatasource.query(i)),this.$q.all(t).then(function(e){return{data:n.default.flatten(e)}})}},{key:"annotationQuery",value:function(e){throw new Error("Annotation Support not implemented yet.")}},{key:"metricFindQuery",value:function(e){if(!e)return Promise.resolve([]);var t=this.appInsightsDatasource.metricFindQuery(e);if(t)return t;var r=this.azureMonitorDatasource.metricFindQuery(e);return r||Promise.resolve([])}},{key:"testDatasource",value:function(){var e=[];return this.azureMonitorDatasource.isConfigured()&&e.push(this.azureMonitorDatasource.testDatasource()),this.appInsightsDatasource.isConfigured()&&e.push(this.appInsightsDatasource.testDatasource()),0===e.length?{status:"error",message:"Nothing configured. At least one of the API's must be configured.",title:"Error"}:this.$q.all(e).then(function(e){for(var t="success",r="",i=0;i<e.length;i++)"success"!==e[i].status&&(t=e[i].status),r+=i+1+". "+e[i].message+" ";return{status:t,message:r,title:n.default.upperFirst(t)}})}},{key:"getResourceGroups",value:function(){return this.azureMonitorDatasource.getResourceGroups()}},{key:"getMetricDefinitions",value:function(e){return this.azureMonitorDatasource.getMetricDefinitions(e)}},{key:"getResourceNames",value:function(e,t){return this.azureMonitorDatasource.getResourceNames(e,t)}},{key:"getMetricNames",value:function(e,t,r){return this.azureMonitorDatasource.getMetricNames(e,t,r)}},{key:"getMetricMetadata",value:function(e,t,r,i){return this.azureMonitorDatasource.getMetricMetadata(e,t,r,i)}},{key:"getAppInsightsMetricNames",value:function(){return this.appInsightsDatasource.getMetricNames()}},{key:"getAppInsightsMetricMetadata",value:function(e){return this.appInsightsDatasource.getMetricMetadata(e)}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=l(r(0)),a=l(r(7)),o=l(r(9)),s=l(r(10)),u=l(r(11)),c=l(r(1));function l(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t,r,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.instanceSettings=t,this.backendSrv=r,this.templateSrv=i,this.$q=n,this.apiVersion="2018-01-01",this.defaultDropdownValue="select",this.supportedMetricNamespaces=[],this.id=t.id,this.subscriptionId=t.jsonData.subscriptionId,this.cloudName=t.jsonData.cloudName||"azuremonitor",this.baseUrl="/"+this.cloudName+"/subscriptions/"+this.subscriptionId+"/resourceGroups",this.url=t.url,this.supportedMetricNamespaces=new u.default(this.cloudName).get()}return i(e,[{key:"isConfigured",value:function(){return this.subscriptionId&&this.subscriptionId.length>0}},{key:"query",value:function(e){var t=this,r=n.default.filter(e.targets,function(e){return!0!==e.hide&&e.azureMonitor.resourceGroup&&e.azureMonitor.resourceGroup!==t.defaultDropdownValue&&e.azureMonitor.resourceName&&e.azureMonitor.resourceName!==t.defaultDropdownValue&&e.azureMonitor.metricDefinition&&e.azureMonitor.metricDefinition!==t.defaultDropdownValue&&e.azureMonitor.metricName&&e.azureMonitor.metricName!==t.defaultDropdownValue}).map(function(r){var i=r.azureMonitor;i.timeGrainUnit&&"auto"!==i.timeGrain&&(i.timeGrain=c.default.createISO8601Duration(i.timeGrain,i.timeGrainUnit));var n=t.templateSrv.replace(i.resourceGroup,e.scopedVars),s=t.templateSrv.replace(i.resourceName,e.scopedVars),u=t.templateSrv.replace(i.metricDefinition,e.scopedVars),l=(t.templateSrv.replace(i.metricName,e.scopedVars),t.templateSrv.replace((i.timeGrain||"").toString(),e.scopedVars)),f=new a.default(i.metricName,e.range.from,e.range.to,l,e.interval);i.timeGrains&&f.setAllowedTimeGrains(i.timeGrains),i.aggregation&&f.setAggregation(i.aggregation),i.dimension&&"None"!==i.dimension&&f.setDimensionFilter(i.dimension,i.dimensionFilter);var p=t.templateSrv.replace(f.generateFilter(),e.scopedVars),d=o.default.buildAzureMonitorQueryUrl(t.baseUrl,n,u,s,t.apiVersion,p);return{refId:r.refId,intervalMs:e.intervalMs,maxDataPoints:e.maxDataPoints,datasourceId:t.id,url:d,format:e.format,alias:i.alias}});if(0===r.length)return this.$q.when({data:[]});var i=this.doQueries(r);return this.$q.all(i).then(function(e){return new s.default(e).parseQueryResult()})}},{key:"doQueries",value:function(e){var t=this;return n.default.map(e,function(e){return t.doRequest(e.url).then(function(t){return{result:t,query:e}}).catch(function(t){throw{error:t,query:e}})})}},{key:"annotationQuery",value:function(e){}},{key:"metricFindQuery",value:function(e){if(e.match(/^ResourceGroups\(\)/i))return this.getResourceGroups();var t=e.match(/^Namespaces\(([^\)]+?)(,\s?([^,]+?))?\)/i);if(t)return this.getMetricDefinitions(this.toVariable(t[1]));var r=e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?)\)/i);if(r){var i=this.toVariable(r[1]),n=this.toVariable(r[2]);return this.getResourceNames(i,n)}var a=e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/i);if(a){var o=this.toVariable(a[1]),s=this.toVariable(a[2]),u=this.toVariable(a[3]);return this.getMetricNames(o,s,u)}}},{key:"toVariable",value:function(e){return this.templateSrv.replace((e||"").trim())}},{key:"getResourceGroups",value:function(){var e=this.baseUrl+"?api-version=2018-01-01";return this.doRequest(e).then(function(e){return s.default.parseResponseValues(e,"name","name")})}},{key:"getMetricDefinitions",value:function(e){var t=this,r=this.baseUrl+"/"+e+"/resources?api-version=2018-01-01";return this.doRequest(r).then(function(e){return s.default.parseResponseValues(e,"type","type")}).then(function(e){return n.default.filter(e,function(e){for(var r=0;r<t.supportedMetricNamespaces.length;r++)if(n.default.startsWith(e.value.toLowerCase(),t.supportedMetricNamespaces[r].toLowerCase()))return!0;return!1})}).then(function(e){for(var t=!1,r=0;r<e.length;r++)if("Microsoft.Storage/storageAccounts"===e[r].value){t=!0;break}return t&&(e.push({text:"Microsoft.Storage/storageAccounts/blobServices",value:"Microsoft.Storage/storageAccounts/blobServices"}),e.push({text:"Microsoft.Storage/storageAccounts/fileServices",value:"Microsoft.Storage/storageAccounts/fileServices"}),e.push({text:"Microsoft.Storage/storageAccounts/tableServices",value:"Microsoft.Storage/storageAccounts/tableServices"}),e.push({text:"Microsoft.Storage/storageAccounts/queueServices",value:"Microsoft.Storage/storageAccounts/queueServices"})),e})}},{key:"getResourceNames",value:function(e,t){var r=this.baseUrl+"/"+e+"/resources?api-version=2018-01-01";return this.doRequest(r).then(function(e){if(!n.default.startsWith(t,"Microsoft.Storage/storageAccounts/"))return s.default.parseResourceNames(e,t);for(var r=s.default.parseResourceNames(e,"Microsoft.Storage/storageAccounts"),i=0;i<r.length;i++)r[i].text+="/default",r[i].value+="/default";return r})}},{key:"getMetricNames",value:function(e,t,r){var i=o.default.buildAzureMonitorGetMetricNamesUrl(this.baseUrl,e,t,r,this.apiVersion);return this.doRequest(i).then(function(e){return s.default.parseResponseValues(e,"name.localizedValue","name.value")})}},{key:"getMetricMetadata",value:function(e,t,r,i){var n=o.default.buildAzureMonitorGetMetricNamesUrl(this.baseUrl,e,t,r,this.apiVersion);return this.doRequest(n).then(function(e){return s.default.parseMetadata(e,i)})}},{key:"testDatasource",value:function(){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."};var e=this.baseUrl+"?api-version=2018-01-01";return this.doRequest(e).then(function(e){if(200===e.status)return{status:"success",message:"Successfully queried the Azure Monitor service.",title:"Success"}}).catch(function(e){var t="Azure Monitor: ";return t+=e.statusText?e.statusText+": ":"",e.data&&e.data.error&&e.data.error.code?t+=e.data.error.code+". "+e.data.error.message:e.data&&e.data.error?t+=e.data.error:e.data?t+=e.data:t+="Cannot connect to Azure Monitor REST API.",{status:"error",message:t}})}},{key:"isValidConfigField",value:function(e){return e&&e.length>0}},{key:"doRequest",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.backendSrv.datasourceRequest({url:this.url+e,method:"GET"}).catch(function(i){if(r>0)return t.doRequest(e,r-1);throw i})}}]),e}();t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=r(1),o=(i=a)&&i.__esModule?i:{default:i};var s=function(){function e(t,r,i,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metricName=t,this.from=r,this.to=i,this.timeGrain=n,this.grafanaInterval=a,this.timeGrainInterval="",this.allowedTimeGrains=["1m","5m","15m","30m","1h","6h","12h","1d"]}return n(e,[{key:"setAllowedTimeGrains",value:function(e){var t=this;this.allowedTimeGrains=[],e.forEach(function(e){"auto"===e.value?t.allowedTimeGrains.push(e.value):t.allowedTimeGrains.push(o.default.createKbnUnitFromISO8601Duration(e.value))})}},{key:"setAggregation",value:function(e){this.aggregation=e}},{key:"setDimensionFilter",value:function(e,t){this.dimension=e,this.dimensionFilter=t}},{key:"generateFilter",value:function(){var e=this.createDatetimeAndTimeGrainConditions();return this.aggregation&&(e+="&aggregation="+this.aggregation),this.metricName&&this.metricName.trim().length>0&&(e+="&metricnames="+this.metricName),this.dimension&&this.dimensionFilter&&this.dimensionFilter.trim().length>0&&(e+="&$filter="+this.dimension+" eq '"+this.dimensionFilter+"'"),e}},{key:"createDatetimeAndTimeGrainConditions",value:function(){var e="timespan="+this.from.utc().format()+"/"+this.to.utc().format();return"auto"===this.timeGrain&&(this.timeGrain=this.calculateAutoTimeGrain()),e+("&interval="+this.timeGrain)}},{key:"calculateAutoTimeGrain",value:function(){var e=o.default.findClosestTimeGrain(this.grafanaInterval,this.allowedTimeGrains);return o.default.createISO8601DurationFromInterval(e)}}]),e}();t.default=s},function(e,t){e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=r(0),o=(i=a)&&i.__esModule?i:{default:i};var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"buildAzureMonitorQueryUrl",value:function(e,t,r,i,n,a){if(o.default.startsWith(r,"Microsoft.Storage/storageAccounts/")||"Microsoft.Sql/servers/databases"===r){var s=i.split("/"),u=r.substring(r.lastIndexOf("/")+1);return e+"/"+t+"/providers/"+r.substring(0,r.lastIndexOf("/"))+"/"+s[0]+"/"+u+"/"+s[1]+"/providers/microsoft.insights/metrics?api-version="+n+"&"+a}return e+"/"+t+"/providers/"+r+"/"+i+"/providers/microsoft.insights/metrics?api-version="+n+"&"+a}},{key:"buildAzureMonitorGetMetricNamesUrl",value:function(e,t,r,i,n){if(o.default.startsWith(r,"Microsoft.Storage/storageAccounts/")||"Microsoft.Sql/servers/databases"===r){var a=i.split("/"),s=r.substring(r.lastIndexOf("/")+1);return e+"/"+t+"/providers/"+r.substring(0,r.lastIndexOf("/"))+"/"+a[0]+"/"+s+"/"+a[1]+"/providers/microsoft.insights/metricdefinitions?api-version="+n}return e+"/"+t+"/providers/"+r+"/"+i+"/providers/microsoft.insights/metricdefinitions?api-version="+n}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=s(r(2)),a=s(r(0)),o=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.results=t}return i(e,[{key:"parseQueryResult",value:function(){for(var t=[],r=0;r<this.results.length;r++)for(var i=0;i<this.results[r].result.data.value.length;i++)for(var n=0;n<this.results[r].result.data.value[i].timeseries.length;n++){var a=this.results[r].query.alias;t.push({target:e.createTarget(this.results[r].result.data.value[i],this.results[r].result.data.value[i].timeseries[n].metadatavalues,a),datapoints:e.convertDataToPoints(this.results[r].result.data.value[i].timeseries[n].data)})}return t}}],[{key:"createTarget",value:function(t,r,i){var n=e.parseResourceGroupFromId(t.id),a=e.parseResourceNameFromId(t.id),o=e.parseNamespaceFromId(t.id,a);if(i){return i.replace(/\{\{([\s\S]+?)\}\}/g,function(e,i,s){var u=i||s;return"resourcegroup"===u?n:"namespace"===u?o:"resourcename"===u?a:"metric"===u?t.name.value:"dimensionname"===u?r&&r.length>0?r[0].name.value:"":"dimensionvalue"===u?r&&r.length>0?r[0].value:"":e})}return r&&r.length>0?a+"{"+r[0].name.value+"="+r[0].value+"}."+t.name.value:a+"."+t.name.value}},{key:"parseResourceGroupFromId",value:function(e){var t=e.indexOf("/resourceGroups/")+16,r=e.indexOf("/providers");return e.substring(t,r)}},{key:"parseNamespaceFromId",value:function(e,t){var r=e.indexOf("/providers/")+11,i=e.indexOf("/"+t);return e.substring(r,i)}},{key:"parseResourceNameFromId",value:function(e){var t=e.lastIndexOf("/providers"),r=e.slice(0,t).lastIndexOf("/")+1;return e.substring(r,t)}},{key:"convertDataToPoints",value:function(t){for(var r=[],i=0;i<t.length;i++){var n=e.dateTimeToEpoch(t[i].timeStamp),a=e.getKeyForAggregationField(t[i]);a&&r.push([t[i][a],n])}return r}},{key:"dateTimeToEpoch",value:function(e){return(0,n.default)(e).valueOf()}},{key:"getKeyForAggregationField",value:function(e){var t=a.default.keys(e);if(!(t.length<2))return a.default.intersection(t,["total","average","maximum","minimum","count"])}},{key:"parseResponseValues",value:function(e,t,r){for(var i=[],n=0;n<e.data.value.length;n++)a.default.find(i,["value",a.default.get(e.data.value[n],r)])||i.push({text:a.default.get(e.data.value[n],t),value:a.default.get(e.data.value[n],r)});return i}},{key:"parseResourceNames",value:function(e,t){for(var r=[],i=0;i<e.data.value.length;i++)e.data.value[i].type===t&&r.push({text:e.data.value[i].name,value:e.data.value[i].name});return r}},{key:"parseMetadata",value:function(t,r){var i=a.default.find(t.data.value,function(e){return a.default.get(e,"name.value")===r});return{primaryAggType:i.primaryAggregationType,supportedAggTypes:i.supportedAggregationTypes||["None","Average","Minimum","Maximum","Total","Count"],supportedTimeGrains:e.parseTimeGrains(i.metricAvailabilities||[]),dimensions:e.parseDimensions(i)}}},{key:"parseTimeGrains",value:function(e){var t=[];return e.forEach(function(e){e.timeGrain&&t.push({text:o.default.createTimeGrainFromISO8601Duration(e.timeGrain),value:e.timeGrain})}),t}},{key:"parseDimensions",value:function(e){var t=[];if(!e.dimensions||0===e.dimensions.length)return t;e.isDimensionRequired||t.push({text:"None",value:"None"});for(var r=0;r<e.dimensions.length;r++)t.push({text:e.dimensions[r].localizedValue,value:e.dimensions[r].value});return t}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cloudName=t,this.supportedMetricNamespaces={azuremonitor:["Microsoft.Compute","Microsoft.ClassicCompute","Microsoft.Storage","Microsoft.Sql","Microsoft.Web","Microsoft.EventHub","Microsoft.ServiceBus","Microsoft.Devices","Microsoft.DocumentDb","Microsoft.Network","Microsoft.Cache/Redis","Microsoft.AnalysisServices/servers","Microsoft.ApiManagement/service","Microsoft.Automation/automationAccounts","Microsoft.Batch/batchAccounts","Microsoft.CognitiveServices/accounts","Microsoft.CustomerInsights/hubs","Microsoft.DataLakeAnalytics/accounts","Microsoft.DataLakeStore/accounts","Microsoft.DBforMySQL/servers","Microsoft.DBforPostgreSQL/servers","Microsoft.Logic/workflows","Microsoft.NotificationHubs/Namespaces/NotificationHubs","Microsoft.Search/searchServices","Microsoft.StreamAnalytics/streamingjobs","Microsoft.DataFactory/datafactories","Microsoft.DataFactory/factories","Microsoft.KeyVaults/vaults","Microsoft.LocationBasedServices/accounts","Microsoft.PowerBIDedicated/capacities","Microsoft.Relay/namespaces"],govazuremonitor:["Microsoft.AnalysisServices/Servers","Microsoft.ApiManagement/service","Microsoft.Compute/virtualMachines","Microsoft.Compute/virtualMachineScaleSets","Microsoft.Compute/virtualMachineScaleSets/virtualMachines","Microsoft.Devices/IotHubs","Microsoft.Devices/provisioningServices","Microsoft.Devices/ElasticPools","Microsoft.Devices/ElasticPools/IotHubtTenants","Microsoft.EventHubs/namespaces","Microsoft.Insights/AutoscaleSettings","Microsoft.KeyVault/vaults","Microsoft.Network/loadBalancers","Microsoft.Network/publicIPAdresses","Microsoft.Network/applicationGateways","Microsoft.Network/virtualNetworkGateways","Microsoft.Network/expressRouteCircuits","Microsoft.Network/trafficManagerProfiles","Microsoft.NotificationHubs/Namespaces/NotificationHubs","Microsoft.PowerBiDedicated/capacities","Microsoft.ServiceBus/namespaces","Microsoft.Sql/servers/databases","Microsoft.Sql/servers/elasticPools","Microsoft.Sql/servers","Microsoft.Web/serverfarms","Microsoft.Web/sites","Microsoft.Web/sites/slots","Microsoft.Web/hostingEnvironments/multiRolePools","Microsoft.Web/hostingEnvironments/workerPools"],germanyazuremonitor:["Microsoft.AnalysisServices/Servers","Microsoft.Compute/virtualMachines","Microsoft.Compute/virtualMachineScaleSets","Microsoft.Compute/virtualMachineScaleSets/virtualMachines","Microsoft.Devices/IotHubs","Microsoft.Devices/provisioningServices","Microsoft.Devices/ElasticPools","Microsoft.Devices/ElasticPools/IotHubtTenants","Microsoft.EventHubs/namespaces","Microsoft.Insights/AutoscaleSettings","Microsoft.KeyVault/vaults","Microsoft.Network/loadBalancers","Microsoft.Network/publicIPAdresses","Microsoft.Network/applicationGateways","Microsoft.Network/virtualNetworkGateways","Microsoft.Network/expressRouteCircuits","Microsoft.Network/trafficManagerProfiles","Microsoft.NotificationHubs/Namespaces/NotificationHubs","Microsoft.ServiceBus/namespaces","Microsoft.Sql/servers/databases","Microsoft.Sql/servers/elasticPools","Microsoft.Sql/servers","Microsoft.Web/serverfarms","Microsoft.Web/sites","Microsoft.Web/sites/slots","Microsoft.Web/hostingEnvironments/multiRolePools","Microsoft.Web/hostingEnvironments/workerPools"],chinaazuremonitor:["Microsoft.AnalysisServices/Servers","Microsoft.ApiManagement/service","Microsoft.Compute/virtualMachines","Microsoft.Compute/virtualMachineScaleSets","Microsoft.Compute/virtualMachineScaleSets/virtualMachines","Microsoft.Devices/IotHubs","Microsoft.Devices/provisioningServices","Microsoft.Devices/ElasticPools","Microsoft.Devices/ElasticPools/IotHubtTenants","Microsoft.EventHubs/namespaces","Microsoft.Insights/AutoscaleSettings","Microsoft.KeyVault/vaults","Microsoft.Network/loadBalancers","Microsoft.Network/publicIPAdresses","Microsoft.Network/applicationGateways","Microsoft.Network/virtualNetworkGateways","Microsoft.Network/expressRouteCircuits","Microsoft.Network/trafficManagerProfiles","Microsoft.NotificationHubs/Namespaces/NotificationHubs","Microsoft.ServiceBus/namespaces","Microsoft.Sql/servers/databases","Microsoft.Sql/servers/elasticPools","Microsoft.Sql/servers","Microsoft.Web/serverfarms","Microsoft.Web/sites","Microsoft.Web/sites/slots","Microsoft.Web/hostingEnvironments/multiRolePools","Microsoft.Web/hostingEnvironments/workerPools"]}}return i(e,[{key:"get",value:function(){return this.supportedMetricNamespaces[this.cloudName]}}]),e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=s(r(0)),a=s(r(13)),o=s(r(14));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,r,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.backendSrv=r,this.templateSrv=i,this.$q=n,this.version="beta",this.id=t.id,this.applicationId=t.jsonData.appInsightsAppId,this.baseUrl="/appinsights/"+this.version+"/apps/"+this.applicationId+"/metrics",this.url=t.url}return i(e,[{key:"isConfigured",value:function(){return this.applicationId&&this.applicationId.length>0}},{key:"query",value:function(e){var t=this,r=n.default.filter(e.targets,function(e){return!0!==e.hide}).map(function(r){var i=r.appInsights,n=new a.default(e.range.from,e.range.to,e.interval);"none"!==i.groupBy&&n.setGroupBy(t.templateSrv.replace(i.groupBy,e.scopedVars)),n.setAggregation(i.aggregation),n.setInterval(i.timeGrainType,t.templateSrv.replace(i.timeGrain,e.scopedVars),i.timeGrainUnit),n.setFilter(t.templateSrv.replace(i.filter||""));var o=t.baseUrl+"/"+t.templateSrv.replace(i.metricName,e.scopedVars)+"?"+n.generate();return{refId:r.refId,intervalMs:e.intervalMs,maxDataPoints:e.maxDataPoints,datasourceId:t.id,url:o,format:e.format,alias:i.alias}});if(0===r.length)return this.$q.when({data:[]});var i=this.doQueries(r);return this.$q.all(i).then(function(e){return new o.default(e).parseQueryResult()})}},{key:"doQueries",value:function(e){var t=this;return n.default.map(e,function(e){return t.doRequest(e.url).then(function(t){return{result:t,query:e}}).catch(function(t){throw{error:t,query:e}})})}},{key:"annotationQuery",value:function(e){}},{key:"metricFindQuery",value:function(e){if(e.match(/^AppInsightsMetricNames\(\)/i))return this.getMetricNames();var t=e.match(/^AppInsightsGroupBys\(([^\)]+?)(,\s?([^,]+?))?\)/i);if(t){var r=t[1];return this.getGroupBys(this.templateSrv.replace(r))}}},{key:"testDatasource",value:function(){var e=this.baseUrl+"/metadata";return this.doRequest(e).then(function(e){if(200===e.status)return{status:"success",message:"Successfully queried the Application Insights service.",title:"Success"}}).catch(function(e){var t="Application Insights: ";return t+=e.statusText?e.statusText+": ":"",e.data&&e.data.error&&"PathNotFoundError"===e.data.error.code?t+="Invalid Application Id for Application Insights service.":e.data&&e.data.error?t+=e.data.error.code+". "+e.data.error.message:t+="Cannot connect to Application Insights REST API.",{status:"error",message:t}})}},{key:"doRequest",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.backendSrv.datasourceRequest({url:this.url+e,method:"GET"}).catch(function(i){if(r>0)return t.doRequest(e,r-1);throw i})}},{key:"getMetricNames",value:function(){var e=this.baseUrl+"/metadata";return this.doRequest(e).then(o.default.parseMetricNames)}},{key:"getMetricMetadata",value:function(e){var t=this.baseUrl+"/metadata";return this.doRequest(t).then(function(t){return new o.default(t).parseMetadata(e)})}},{key:"getGroupBys",value:function(e){return this.getMetricMetadata(e).then(function(e){return new o.default(e).parseGroupBys()})}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=r(1),o=(i=a)&&i.__esModule?i:{default:i};var s=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.from=t,this.to=r,this.grafanaInterval=i,this.aggregation="",this.groupBy="",this.timeGrainType="",this.timeGrain="",this.timeGrainUnit="",this.filter=""}return n(e,[{key:"setAggregation",value:function(e){this.aggregation=e}},{key:"setGroupBy",value:function(e){this.groupBy=e}},{key:"setInterval",value:function(e,t,r){this.timeGrainType=e,this.timeGrain=t,this.timeGrainUnit=r}},{key:"setFilter",value:function(e){this.filter=e}},{key:"generate",value:function(){var e="timespan="+this.from.utc().format()+"/"+this.to.utc().format();return this.aggregation&&this.aggregation.length>0&&(e+="&aggregation="+this.aggregation),this.groupBy&&this.groupBy.length>0&&(e+="&segment="+this.groupBy),"specific"===this.timeGrainType&&this.timeGrain&&this.timeGrainUnit&&(e+="&interval="+o.default.createISO8601Duration(this.timeGrain,this.timeGrainUnit)),"auto"===this.timeGrainType&&(e+="&interval="+o.default.createISO8601DurationFromInterval(this.grafanaInterval)),this.filter&&(e+="&filter="+this.filter),e}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=o(r(2)),a=o(r(0));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.results=t}return i(e,[{key:"parseQueryResult",value:function(){for(var e=[],t=0;t<this.results.length;t++){var r=this.results[t].result.data.value,i=this.results[t].query.alias;e=a.default.concat(e,this.parseQueryResultRow(r,i))}return e}},{key:"parseQueryResultRow",value:function(t,r){var i=[];if(e.isSingleValue(t)){var n=e.getMetricFieldKey(t),a=e.getKeyForAggregationField(t[n]),o=e.dateTimeToEpoch(t.end);return i.push({target:n,datapoints:[[t[n][a],o]]}),i}if(e.hasSegmentsField(t.segments[0]))for(var s=0;s<t.segments.length;s++)for(var u=e.dateTimeToEpoch(t.segments[s].end),c=0;c<t.segments[s].segments.length;c++){var l=e.getMetricFieldKey(t.segments[s].segments[c]),f=e.getKeyForAggregationField(t.segments[s].segments[c][l]),p=this.getTargetName(t.segments[s].segments[c],r);e.findOrCreateBucket(i,p).datapoints.push([t.segments[s].segments[c][l][f],u])}else for(var d=e.getMetricFieldKey(t.segments[0]),h=e.findOrCreateBucket(i,d),m=0;m<t.segments.length;m++){var g=e.dateTimeToEpoch(t.segments[m].end),v=e.getKeyForAggregationField(t.segments[m][d]);h.datapoints.push([t.segments[m][d][v],g])}return i}},{key:"getTargetName",value:function(e,t){var r="",i="",n="";for(var o in e)a.default.isObject(e[o])?r=o:(i=o,n=e[o]);if(t){return t.replace(/\{\{([\s\S]+?)\}\}/g,function(e,t,a){var o=t||a;return"metric"===o?r:"groupbyname"===o?i:"groupbyvalue"===o?n:e})}return r+"{"+i+'="'+n+'"}'}},{key:"parseMetadata",value:function(e){var t=this.results.data.metrics[e];if(!t)throw Error("No data found for metric: "+e);return{primaryAggType:t.defaultAggregation,supportedAggTypes:t.supportedAggregations,supportedGroupBy:t.supportedGroupBy.all}}},{key:"parseGroupBys",value:function(){return e.toTextValueList(this.results.supportedGroupBy)}}],[{key:"isSingleValue",value:function(t){return!e.hasSegmentsField(t)}},{key:"findOrCreateBucket",value:function(e,t){var r=a.default.find(e,["target",t]);return r||(r={target:t,datapoints:[]},e.push(r)),r}},{key:"hasSegmentsField",value:function(e){var t=a.default.keys(e);return a.default.indexOf(t,"segments")>-1}},{key:"getMetricFieldKey",value:function(e){var t=a.default.keys(e);return a.default.filter(a.default.without(t,"start","end"),function(t){return a.default.isObject(e[t])})[0]}},{key:"getKeyForAggregationField",value:function(e){var t=a.default.keys(e);return a.default.intersection(t,["sum","avg","min","max","count","unique"])}},{key:"dateTimeToEpoch",value:function(e){return(0,n.default)(e).valueOf()}},{key:"parseMetricNames",value:function(t){var r=a.default.keys(t.data.metrics);return e.toTextValueList(r)}},{key:"toTextValueList",value:function(e){for(var t=[],r=0;r<e.length;r++)t.push({text:e[r],value:e[r]});return t}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AzureMonitorQueryCtrl=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=s(r(0)),a=r(16);r(17);var o=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}(t.AzureMonitorQueryCtrl=function(e){function t(e,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return a.templateSrv=i,a.defaultDropdownValue="select",a.defaults={queryType:"Azure Monitor",azureMonitor:{resourceGroup:a.defaultDropdownValue,metricDefinition:a.defaultDropdownValue,resourceName:a.defaultDropdownValue,metricName:a.defaultDropdownValue,dimensionFilter:"*",timeGrain:"auto"},appInsights:{metricName:a.defaultDropdownValue,groupBy:"none",timeGrainType:"auto"}},n.default.defaultsDeep(a.target,a.defaults),a.migrateTimeGrains(),a.panelCtrl.events.on("data-received",a.onDataReceived.bind(a),e),a.panelCtrl.events.on("data-error",a.onDataError.bind(a),e),a}return t.$inject=["$scope","$injector","templateSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"onDataReceived",value:function(e){this.lastQueryError=void 0}},{key:"onDataError",value:function(e){this.handleQueryCtrlError(e)}},{key:"handleQueryCtrlError",value:function(e){e.query&&e.query.refId&&e.query.refId!==this.target.refId||(e.error&&e.error.data&&e.error.data.error?this.lastQueryError=e.error.data.error.message:e.error&&e.error.data?this.lastQueryError=e.error.data.message:e.data&&e.data.error?this.lastQueryError=e.data.error.message:e.data&&e.data.message?this.lastQueryError=e.data.message:this.lastQueryError=e)}},{key:"migrateTimeGrains",value:function(){this.target.azureMonitor.timeGrainUnit&&("auto"!==this.target.azureMonitor.timeGrain&&(this.target.azureMonitor.timeGrain=o.default.createISO8601Duration(this.target.azureMonitor.timeGrain,this.target.azureMonitor.timeGrainUnit)),delete this.target.azureMonitor.timeGrainUnit,this.onMetricNameChange())}},{key:"replace",value:function(e){return this.templateSrv.replace(e,this.panelCtrl.panel.scopedVars)}},{key:"getResourceGroups",value:function(e){if("Azure Monitor"===this.target.queryType&&this.datasource.azureMonitorDatasource.isConfigured())return this.datasource.getResourceGroups().catch(this.handleQueryCtrlError.bind(this))}},{key:"getMetricDefinitions",value:function(e){if("Azure Monitor"===this.target.queryType&&this.target.azureMonitor.resourceGroup&&this.target.azureMonitor.resourceGroup!==this.defaultDropdownValue)return this.datasource.getMetricDefinitions(this.replace(this.target.azureMonitor.resourceGroup)).catch(this.handleQueryCtrlError.bind(this))}},{key:"getResourceNames",value:function(e){if("Azure Monitor"===this.target.queryType&&this.target.azureMonitor.resourceGroup&&this.target.azureMonitor.resourceGroup!==this.defaultDropdownValue&&this.target.azureMonitor.metricDefinition&&this.target.azureMonitor.metricDefinition!==this.defaultDropdownValue){this.templateSrv.replace(this.target.azureMonitor.resourceGroup,this.panelCtrl.panel.scopedVars);return this.datasource.getResourceNames(this.replace(this.target.azureMonitor.resourceGroup),this.replace(this.target.azureMonitor.metricDefinition)).catch(this.handleQueryCtrlError.bind(this))}}},{key:"getMetricNames",value:function(e){if("Azure Monitor"===this.target.queryType&&this.target.azureMonitor.resourceGroup&&this.target.azureMonitor.resourceGroup!==this.defaultDropdownValue&&this.target.azureMonitor.metricDefinition&&this.target.azureMonitor.metricDefinition!==this.defaultDropdownValue&&this.target.azureMonitor.resourceName&&this.target.azureMonitor.resourceName!==this.defaultDropdownValue)return this.datasource.getMetricNames(this.replace(this.target.azureMonitor.resourceGroup),this.replace(this.target.azureMonitor.metricDefinition),this.replace(this.target.azureMonitor.resourceName)).catch(this.handleQueryCtrlError.bind(this))}},{key:"onResourceGroupChange",value:function(){this.target.azureMonitor.metricDefinition=this.defaultDropdownValue,this.target.azureMonitor.resourceName=this.defaultDropdownValue,this.target.azureMonitor.metricName=this.defaultDropdownValue,this.target.azureMonitor.dimensions=[],this.target.azureMonitor.dimension=""}},{key:"onMetricDefinitionChange",value:function(){this.target.azureMonitor.resourceName=this.defaultDropdownValue,this.target.azureMonitor.metricName=this.defaultDropdownValue,this.target.azureMonitor.dimensions=[],this.target.azureMonitor.dimension=""}},{key:"onResourceNameChange",value:function(){this.target.azureMonitor.metricName=this.defaultDropdownValue,this.target.azureMonitor.dimensions=[],this.target.azureMonitor.dimension=""}},{key:"onMetricNameChange",value:function(){var e=this;if(this.target.azureMonitor.metricName&&this.target.azureMonitor.metricName!==this.defaultDropdownValue)return this.datasource.getMetricMetadata(this.replace(this.target.azureMonitor.resourceGroup),this.replace(this.target.azureMonitor.metricDefinition),this.replace(this.target.azureMonitor.resourceName),this.replace(this.target.azureMonitor.metricName)).then(function(t){return e.target.azureMonitor.aggOptions=t.supportedAggTypes||[t.primaryAggType],e.target.azureMonitor.aggregation=t.primaryAggType,e.target.azureMonitor.timeGrains=[{text:"auto",value:"auto"}].concat(t.supportedTimeGrains),e.target.azureMonitor.dimensions=t.dimensions,t.dimensions.length>0&&(e.target.azureMonitor.dimension=t.dimensions[0].value),e.refresh()}).catch(this.handleQueryCtrlError.bind(this))}},{key:"getAutoInterval",value:function(){return"auto"===this.target.azureMonitor.timeGrain?o.default.findClosestTimeGrain(this.panelCtrl.interval,n.default.map(this.target.azureMonitor.timeGrains,function(e){return o.default.createKbnUnitFromISO8601Duration(e.value)})||["1m","5m","15m","30m","1h","6h","12h","1d"]):""}},{key:"getAppInsightsAutoInterval",value:function(){return"s"===this.panelCtrl.interval[this.panelCtrl.interval.length-1]?"1m":this.panelCtrl.interval}},{key:"getAppInsightsMetricNames",value:function(){if(this.datasource.appInsightsDatasource.isConfigured())return this.datasource.getAppInsightsMetricNames().catch(this.handleQueryCtrlError.bind(this))}},{key:"onAppInsightsMetricNameChange",value:function(){var e=this;if(this.target.appInsights.metricName&&this.target.appInsights.metricName!==this.defaultDropdownValue)return this.datasource.getAppInsightsMetricMetadata(this.replace(this.target.appInsights.metricName)).then(function(t){return e.target.appInsights.aggOptions=t.supportedAggTypes,e.target.appInsights.groupByOptions=t.supportedGroupBy,e.target.appInsights.aggregation=t.primaryAggType,e.refresh()}).catch(this.handleQueryCtrlError.bind(this))}},{key:"getAppInsightsGroupBySegments",value:function(e){return n.default.map(this.target.appInsights.groupByOptions,function(e){return{text:e,value:e}})}},{key:"resetAppInsightsGroupBy",value:function(){this.target.appInsights.groupBy="none",this.refresh()}},{key:"updateTimeGrainType",value:function(){"specific"===this.target.appInsights.timeGrainType?(this.target.appInsights.timeGrain="1",this.target.appInsights.timeGrainUnit="minute"):this.target.appInsights.timeGrain="",this.refresh()}}]),t}(a.QueryCtrl)).templateUrl="partials/query.editor.html"},function(e,t){e.exports=i},function(e,t,r){var i=r(18);"string"==typeof i&&(i=[[e.i,i,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};r(3)(i,n);i.locals&&(e.exports=i.locals)},function(e,t,r){var i=r(19);"string"==typeof i&&(i=[[e.i,i,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};r(3)(i,n);i.locals&&(e.exports=i.locals)},function(e,t,r){(e.exports=r(20)(!0)).push([e.i,".min-width-10 {\n  min-width: 10rem;\n}\n\n.min-width-12 {\n  min-width: 12rem;\n}\n\n.min-width-20 {\n  min-width: 20rem;\n}\n\n.gf-form-select-wrapper select.gf-form-input {\n  height: 2.64rem;\n}\n\n.gf-form-select-wrapper--caret-indent.gf-form-select-wrapper::after {\n  right: 0.775rem\n}\n\n.service-dropdown {\n  width: 12rem;\n}\n\n.aggregation-dropdown-wrapper {\n  max-width: 29.1rem;\n}\n\n.timegrainunit-dropdown-wrapper {\n  width: 8rem;\n}\n","",{version:3,sources:["/home/daniel/dev/go/src/github.com/grafana/grafana/data/plugins/grafana-azure-monitor-datasource/src/css/query_editor.css"],names:[],mappings:"AAAA;EACE,iBAAiB;CAClB;;AAED;EACE,iBAAiB;CAClB;;AAED;EACE,iBAAiB;CAClB;;AAED;EACE,gBAAgB;CACjB;;AAED;EACE,eAAe;CAChB;;AAED;EACE,aAAa;CACd;;AAED;EACE,mBAAmB;CACpB;;AAED;EACE,YAAY;CACb",file:"query_editor.css",sourcesContent:[".min-width-10 {\n  min-width: 10rem;\n}\n\n.min-width-12 {\n  min-width: 12rem;\n}\n\n.min-width-20 {\n  min-width: 20rem;\n}\n\n.gf-form-select-wrapper select.gf-form-input {\n  height: 2.64rem;\n}\n\n.gf-form-select-wrapper--caret-indent.gf-form-select-wrapper::after {\n  right: 0.775rem\n}\n\n.service-dropdown {\n  width: 12rem;\n}\n\n.aggregation-dropdown-wrapper {\n  max-width: 29.1rem;\n}\n\n.timegrainunit-dropdown-wrapper {\n  width: 8rem;\n}\n"],sourceRoot:""}])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r=function(e,t){var r=e[1]||"",i=e[3];if(!i)return r;if(t&&"function"==typeof btoa){var n=(o=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),a=i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"});return[r].concat(a).concat([n]).join("\n")}var o;return[r].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r}).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},n=0;n<this.length;n++){var a=this[n][0];"number"==typeof a&&(i[a]=!0)}for(n=0;n<e.length;n++){var o=e[n];"number"==typeof o[0]&&i[o[0]]||(r&&!o[2]?o[2]=r:r&&(o[2]="("+o[2]+") and ("+r+")"),t.push(o))}},t}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var r=t.protocol+"//"+t.host,i=r+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var n,a=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(n=0===a.indexOf("//")?a:0===a.indexOf("/")?r+a:i+a.replace(/^\.\//,""),"url("+JSON.stringify(n)+")")})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(t.AzureMonitorConfigCtrl=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.current.jsonData.cloudName=this.current.jsonData.cloudName||"azuremonitor"}).templateUrl="partials/config.html"}])});
//# sourceMappingURL=module.js.map